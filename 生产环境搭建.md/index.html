<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  

  
  <title>Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="生产环境搭建 安装方式(linux-mysql)(这里是在主目录下安装：)  yum install -y mysql-server  #yum安装，需要外网环境 将rpm文件，传送给linux，然后，通过rpm指令完成安装 rpm -ivh perl-*.rpm  #安装所有perl依赖 rpm -Uvh mysql-libs-5.1.73-7.el6.i686.rpm  #更新mysql的类库">
<meta property="og:type" content="article">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://yoursite.com/生产环境搭建.md/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="生产环境搭建 安装方式(linux-mysql)(这里是在主目录下安装：)  yum install -y mysql-server  #yum安装，需要外网环境 将rpm文件，传送给linux，然后，通过rpm指令完成安装 rpm -ivh perl-*.rpm  #安装所有perl依赖 rpm -Uvh mysql-libs-5.1.73-7.el6.i686.rpm  #更新mysql的类库">
<meta property="og:locale" content="default">
<meta property="og:image" content="d:/Users/asus/AppData/Roaming/feiq/Recv%20Files/wsgi.png">
<meta property="og:updated_time" content="2018-08-05T09:16:23.087Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Hexo">
<meta name="twitter:description" content="生产环境搭建 安装方式(linux-mysql)(这里是在主目录下安装：)  yum install -y mysql-server  #yum安装，需要外网环境 将rpm文件，传送给linux，然后，通过rpm指令完成安装 rpm -ivh perl-*.rpm  #安装所有perl依赖 rpm -Uvh mysql-libs-5.1.73-7.el6.i686.rpm  #更新mysql的类库">
<meta name="twitter:image" content="d:/Users/asus/AppData/Roaming/feiq/Recv%20Files/wsgi.png">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
</head>
</html>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-生产环境搭建" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/生产环境搭建.md/" class="article-date">
  <time datetime="2019-04-21T16:21:12.196Z" itemprop="datePublished">2019-04-22</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>生产环境搭建</p>
<h2 id="安装方式-linux-mysql"><a href="#安装方式-linux-mysql" class="headerlink" title="安装方式(linux-mysql)"></a>安装方式(linux-mysql)</h2><p>(这里是在主目录下安装：)</p>
<ul>
<li><strong>yum install -y mysql-server  #yum安装，需要外网环境</strong></li>
<li><strong>将rpm文件，传送给linux，然后，通过rpm指令完成安装</strong><ul>
<li><strong>rpm -ivh perl-*.rpm  #安装所有perl依赖</strong></li>
<li><strong>rpm -Uvh mysql-libs-5.1.73-7.el6.i686.rpm  #更新mysql的类库</strong></li>
<li><strong>rpm -ivh mysql-5.1.73-7.el6.i686.rpm  mysql-server-5.1.73-7.el6.i686.rpm  #安装mysql主服务</strong></li>
</ul>
</li>
</ul>
<h2 id="启动mysql服务"><a href="#启动mysql服务" class="headerlink" title="启动mysql服务"></a>启动mysql服务</h2><ul>
<li><p><strong>service mysqld start/stop/restart/status</strong>        </p>
<p>登陆mysql表：mysql  -u root  -p123456</p>
</li>
<li><p><strong>选择库</strong> (show databases);  </p>
</li>
<li><p><strong>选择表</strong>(show tables)</p>
</li>
<li><p><strong>查询表</strong>(select * from tables where …….)</p>
</li>
</ul>
<h2 id="远程权限"><a href="#远程权限" class="headerlink" title="远程权限"></a>远程权限</h2><ul>
<li><strong>到mysql库的user表中</strong></li>
<li><strong>update user set host=’%’,password=password(‘123456’) where host=’127.0.0.1’;</strong> #添加可以远程访问的账号</li>
<li><strong>flush privileges;</strong> #刷新权限，保证新添加的账号可用</li>
<li><strong>关闭linux的防护墙，保证3306可以访问</strong>//关闭防火墙方法：service iptables stop </li>
</ul>
<h2 id="防止mysql本地客户端数据乱码"><a href="#防止mysql本地客户端数据乱码" class="headerlink" title="防止mysql本地客户端数据乱码"></a><strong>防止mysql本地客户端数据乱码</strong></h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/etc/my.cnf 中添加如下配置，即可</span><br><span class="line">[client]</span><br><span class="line">default-character-<span class="keyword">set</span>=utf8</span><br></pre></td></tr></table></figure>
<p> <strong>如上配置只作用客户端，要保证程序中数据不乱码：建库，建表时指定统一的字符集即可</strong></p>
<h2 id="mysql卸载"><a href="#mysql卸载" class="headerlink" title="mysql卸载"></a><strong>mysql卸载</strong></h2><ul>
<li><strong>rpm -e mysql-server #只需卸载主服务即可</strong></li>
<li><strong>rm  -rf  /var/lib/mysql #删除所有mysql的数据</strong></li>
</ul>
<h2 id="root密码找回"><a href="#root密码找回" class="headerlink" title="root密码找回"></a><strong>root密码找回</strong></h2><ul>
<li><p><strong>到 /etc/my.cnf下添加配置</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[mysqld]</span><br><span class="line">...</span><br><span class="line">skip-<span class="keyword">grant</span>-<span class="keyword">tables</span>   <span class="comment">#注意，建议在拆除网线的情况下添加  (而且添加配置后，需要重启mysqld服务)（mysqld service restart）</span></span><br><span class="line"><span class="comment">#skip-grant-tables(跳过mysql访问table的权限＝＝不需要密码)</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>mysql -u root -p即可登录mysql</strong></p>
</li>
<li><p><strong>update user set password=password(‘123’) where host=%;//修改密码</strong><br><strong>flush privileges;即可</strong>(用来刷新权限)</p>
</li>
<li><p><strong>将my.cnf的配置删除或注释</strong></p>
</li>
</ul>
<p>##myql安装</p>
<ul>
<li>安装过程 略</li>
<li>安装依赖：<code>yum install mysql-devel</code></li>
<li>安装驱动：<code>pip install mysqlclient</code></li>
</ul>
<p>##python安装</p>
<ul>
<li><p>yum -y install  python-devel  openssl-devel  bzip2-devel  zlib-devel  expat-devel ncurses-devel sqlite-devel gdbm-devel xz-devel tk-devel readline-devel  gcc </p>
</li>
<li><p><em>yum -y groupinstall “Development tools”</em></p>
</li>
<li><p><strong>如上两步，汇总安装了python生产环境的各种第三方依赖包</strong></p>
</li>
<li><p><strong>正式安装，从下一步开始</strong></p>
</li>
<li><p>将python的tar包发送给linux (建议位置：/usr/local/xx) </p>
<p> //所谓的usr/local下的目录是把所有公共共享的资源存放在一个目录下的设置</p>
</li>
<li><p>解压tar包:<code>tar -zxvf Python-3.5.2.tgz</code> ,会在当前目录下，出现解压目录</p>
</li>
<li><p>cd到解压目录中配置：<code>./configure --prefix=/usr/local/python3.5.2 --enable-optimizations</code></p>
<blockquote>
<p>目的：检测环境中依赖是否完整，设置python的安装位置，</p>
<p>​           同时生成一个编译文件，用于进行python编译：make</p>
</blockquote>
</li>
<li><p>cd 到解压目录中：先 <code>make</code> 编译  然后  <code>make  install</code> 安装</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">安装后的日志如下</span><br><span class="line">....</span><br><span class="line">Collecting setuptools</span><br><span class="line">Collecting pip</span><br><span class="line">Installing collected packages: setuptools, pip</span><br><span class="line">Successfully installed pip-8.1.1 setuptools-20.10.1</span><br></pre></td></tr></table></figure>
</li>
<li><p>设置环境变量：/etc/profile中添加配置        //   /etc/profile 用来设置环境变量的文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">在文件末尾追加，不要改动文件的其他内容！！！！！！！</span><br><span class="line">export python_home=/usr/local/python3.5.2</span><br><span class="line">export PATH=$PATH:$python_home/bin</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>注意，设置好后，为了让环境变量生效：</strong><code>source /etc/profile</code>，然后 <code>python3</code>即可进入python3的环境                                                       （source /etc/profile）让环境变量生效</p>
<p><strong>注意，此时系统自带的python2 依然是默认python解释器</strong></p>
</blockquote>
</li>
<li><p><strong>将python3 设置为系统默认python解释器</strong></p>
<ul>
<li><p>将/usr/bin下的<code>python</code>文件删除或改名</p>
</li>
<li><p>将python3的执行文件链接到  /usr/bin/python</p>
<p>​    <code>ln -s /usr/local/python3.5.2/bin/python3 /usr/bin/python</code></p>
</li>
<li><p>由于<code>yum</code>用python2编译执行，所以需要单独为<code>yum</code>设置为python2，找到<code>/usr/bin/yum</code>文件，修改文件头：<code>#!/usr/bin/python2.6</code></p>
</li>
</ul>
</li>
<li><p><strong>更新pip</strong></p>
<ul>
<li><code>pip3 install --upgrade pip</code></li>
</ul>
</li>
</ul>
<p>##Django 安装</p>
<ul>
<li><code>pip install django==&quot;2.0.2&quot;</code></li>
<li>测试使用：<ul>
<li><code>django-admin startproject testproj</code>  在当前目录下创建一个project:”testproj”</li>
<li>cd到testproj目录下的testporj目录下settings.py 修改配置：<code>ALLOWED_HOSTS = [&quot;*&quot;]</code></li>
<li>启动django内置的web服务器。cd到testproj目录下，执行：<code>python manage.py runserver ip:port</code></li>
<li>在浏览器中访问：<code>ip:port</code></li>
</ul>
</li>
</ul>
<p>##WSGI 协议</p>
<blockquote>
<ul>
<li><p>一种Web服务器网关接口。是一个协议，是一个规范。</p>
</li>
<li><p>一个Web服务器（如nginx，uWSGI等服务器）与web应用（如用Django框架写的程序）通信的<strong>规范</strong></p>
</li>
<li><p>python-web应用的中能写什么，服务器能识别什么，都遵循统一的WSGI规范。进而保证双方的通信</p>
</li>
<li><p>WSGI使得 Server 和 App 解强耦合 ，中间连接的是WSGI协议</p>
<p>​    <img src="D:\Users\asus\AppData\Roaming\feiq\Recv Files\wsgi.png" alt="wsgi"></p>
</li>
</ul>
</blockquote>
<p>##uWSGI服务器安装</p>
<blockquote>
<p>WSGI协议下web服务器很多：django内置，uWSGI，gunicorn</p>
</blockquote>
<ul>
<li><p>将tar发送linux</p>
</li>
<li><p>解压tar：<code>tar -zxvf  uwsgi-2.0.17.tar.gz</code></p>
</li>
<li><p>cd到解压目录下，编译：<code>make</code></p>
</li>
<li><p>为了可以更方便的执行  <code>uwsgi   #启动uWSGI服务器</code> ，定制链接：</p>
<p><code>ln -s /usr/local/uwsgi-tar/uwsgi-2.0.17/uwsgi /usr/bin/uwsgi</code></p>
<p>则可以在任意目录下执行 <code>uwsgi</code> 去启动uWSGI服务器</p>
</li>
<li><p>测试使用python的wsgi服务器-uWSGI</p>
<ul>
<li><p>在任意的一个目录中定义一个phthon脚本：hilo.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">application</span><span class="params">(env, start_response)</span>:</span></span><br><span class="line">    start_response(<span class="string">'200 OK'</span>, [(<span class="string">'Content-Type'</span>,<span class="string">'text/html;charset=utf-8'</span>)])</span><br><span class="line">    <span class="keyword">return</span> [bytes(<span class="string">'你好啊！！'</span>,<span class="string">'utf-8'</span>),<span class="string">b'zhjzhj'</span>]</span><br></pre></td></tr></table></figure>
</li>
<li><p>启动uWSGI服务器，并部署hilo.py程序</p>
<p><code>uwsgi --http 192.168.248.128:8001 --wsgi-file hilo.py</code>   <strong>#注意hilo.py可以写成绝对路径</strong></p>
</li>
<li><p>浏览器访问：<code>192.168.248.128:8001</code></p>
</li>
</ul>
</li>
</ul>
<p>##uWSGI服务器启动，并部署django项目</p>
<ul>
<li><p>让uwsgi项目下的django项目和mysql数据库捆绑移植</p>
</li>
<li><p>首要去/etc/my.cnf下去设置mysqld的配置</p>
</li>
<li><p>设置mysql的引擎默认为：innodb**</p>
<p>在<code>/etc/my.cnf</code>的<code>[mysqld]</code>中添加配置：<code>default-storage-engine=InnoDB</code></p>
</li>
<li><p><strong>建议设置为严格模式:</strong></p>
<p>在<code>/etc/my.cnf</code>的<code>[mysqld]</code>中添加配置 :  <code>sql_mode=STRICT_TRANS_TABLES</code></p>
<ul>
<li><code>mysql&gt; show variables where variable_name like &#39;%mode%&#39;;#可以查看mysql的配置参数</code></li>
</ul>
</li>
<li><p><strong>在数据库中建好项目需要的database：“db9”</strong></p>
<ul>
<li>使用Navicat创建即可,注意字符集为 utf8</li>
</ul>
</li>
<li><p><strong>在Django项目的settings.py中修改配置</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">DEBUG = <span class="literal">False</span>  <span class="comment">#去掉开发模式</span></span><br><span class="line">ALLOWED_HOSTS = [<span class="string">"*"</span>] <span class="comment">#开放访问host</span></span><br><span class="line">DATABASES = &#123; <span class="comment">#合适数据库参数</span></span><br><span class="line">    <span class="string">'default'</span>: &#123;</span><br><span class="line">        <span class="string">'ENGINE'</span>: <span class="string">'django.db.backends.mysql'</span>,</span><br><span class="line">        <span class="string">'NAME'</span>: <span class="string">'db9'</span>,</span><br><span class="line">        <span class="string">'USER'</span>: <span class="string">'root'</span>,</span><br><span class="line">        <span class="string">'HOST'</span>: <span class="string">'localhost'</span>,</span><br><span class="line">        <span class="string">'PORT'</span>: <span class="string">'3306'</span>,</span><br><span class="line">        <span class="string">'PASSWORD'</span>: <span class="string">'222222'</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>发送项目到linux并做移植</strong></p>
<p><code>python manage.py makemigrations</code></p>
<p><code>python manage.py migrate</code></p>
</li>
<li><p><strong>编写uWSGI的配置文件</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">随意找一个目录，定义一个文件：config.ini</span><br><span class="line">[uwsgi]</span><br><span class="line">http = <span class="number">192.168</span><span class="number">.248</span><span class="number">.128</span>:<span class="number">9000</span> <span class="comment"># uWSGI服务器访问地址</span></span><br><span class="line"><span class="comment">#uWSGI和nginx通信的port</span></span><br><span class="line">socket = <span class="number">192.168</span><span class="number">.248</span><span class="number">.128</span>:<span class="number">9001</span></span><br><span class="line"><span class="comment"># the base directory (full path)</span></span><br><span class="line">chdir = /usr/local/django_projects/ems <span class="comment">#项目所在目录</span></span><br><span class="line"><span class="comment"># Django's wsgi file</span></span><br><span class="line">wsgi-file = ems/wsgi.py <span class="comment">#基于项目目录的相对路径</span></span><br><span class="line"><span class="comment"># maximum number of worker processes</span></span><br><span class="line">processes = <span class="number">4</span></span><br><span class="line"><span class="comment">#thread numbers startched in each worker process</span></span><br><span class="line">threads = <span class="number">2</span></span><br><span class="line"><span class="comment">#monitor uwsgi status　　用来监控uwsgi的状态</span></span><br><span class="line">stats = <span class="number">192.168</span><span class="number">.248</span><span class="number">.128</span>:<span class="number">9002</span></span><br><span class="line"><span class="comment"># clear environment on exit</span></span><br><span class="line">vacuum = true</span><br><span class="line">pidfile = /usr/local/django_projects/ems/uwsgi.pid <span class="comment">#进程ID存放于此文件，位置可以自定义</span></span><br><span class="line"><span class="comment">#daemonize-run ,file-to-record-log</span></span><br><span class="line">daemonize = /usr/local/django_projects/ems/uwsgi.log <span class="comment">#后台启动模式，日志文件记录位置自定义</span></span><br><span class="line"><span class="comment">#http://ip:port/static/...请求会进入该目录找资源，此处可以指向某个app下的static目录</span></span><br><span class="line"><span class="comment">#或是将所有静态文件汇总到项目的某一个目录下，然后配置在此是更好的选择</span></span><br><span class="line"><span class="comment">#汇集所有已安装app的静态资源到一个目录下，请参见后续内容</span></span><br><span class="line"><span class="comment">#http://ip:port/static/a/b/c/d.png   ==&gt;  /usr/local/xxxx/static9/a/b/c/d.png</span></span><br><span class="line">static-map =/static=/usr/local/django_projects/ems/static9</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>根据如上配置启动uWSGI服务器</strong></p>
<p><code>uwsgi --ini config.ini</code>  <strong>#注意：config.ini是一个相对路径</strong></p>
</li>
<li><p><strong>关闭服务器</strong></p>
<p><code>uwsgi --stop /usr/local/django_projects/ems/uwsgi.pid</code> <strong>#通过进程id文件</strong></p>
</li>
<li><p><strong>部署项目技巧：静态资源管理之汇总</strong></p>
<ul>
<li><p>在project的settings.py中添加配置：<code>STATIC_ROOT = os.path.join(BASE_DIR,&#39;static9&#39;)</code></p>
<p>STATIC_ROOT指向project目录下的<code>static9</code>目录</p>
</li>
<li><p>执行汇总指令：<code>python manage.py collectstatic</code>  </p>
</li>
<li><p>这样所有的静态资源目录会在项目目录下自动生成一个static9目录 </p>
<p><strong>会将所有已安装   <em>APP下的静态资源</em>    以及</strong></p>
<p><strong>额外添加的静态目录   <em>STATICFILES_DIRS</em>  汇总到指定目录</strong></p>
</li>
<li><p>然后在uWSGI的配置文件中：<code>static-map =/static=/usr/local/xxx/xxx  ==&gt;指定目录</code></p>
</li>
</ul>
</li>
</ul>
<h2 id="安装nginx"><a href="#安装nginx" class="headerlink" title="安装nginx"></a>安装nginx</h2><blockquote>
<p>uWSGI属于应用服务器，更适合做动态内容的执行</p>
<p>nginx属于web服务器，更合做静态内容的处理(js,css,image)</p>
</blockquote>
<ul>
<li><p>将tar包发送的linux</p>
</li>
<li><p>解压 <code>tar -zxvf nginx-1.11.1.tar.gz</code> </p>
</li>
<li><p>安装依赖 <code>yum install gcc zlib-devel pcre-devel</code>  <strong>不过gcc和zlib-devel已经安装过</strong></p>
</li>
<li><p>cd到解压目录：./configure    #配置检测</p>
</li>
<li><p>cd到解压目录：make &amp;&amp; make install  #编译并安装</p>
</li>
<li><p>安装完成，安装路径为<code>/usr/local/nginx</code>   ,日志路径为 <code>/usr/local/nginx/logs</code> ,</p>
<p>可执行文件路径为 <code>/usr/local/nginx/sbin</code> ,配置文件路径为 <code>/usr/local/nginx/conf</code></p>
<p>欢迎页面路径为 <code>/usr/local/nginx/html</code></p>
</li>
<li><p><code>ln -s /usr/local/nginx/sbin/nginx /usr/bin/nginx</code> 制作连接，便于执行<code>nginx</code>指令</p>
</li>
<li><p><code>nginx  #启动</code><br><code>nginx -s stop #关闭</code><br><code>nginx -s reload #重启</code></p>
<p><code>http://ip:80即可访问nginx欢迎页面</code></p>
</li>
</ul>
<p>##nginx配置</p>
<blockquote>
<p>到配置路径中的<code>nginx.conf</code> (upstream)</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">upstream django99&#123;</span><br><span class="line">	server 192.168.180.131:9001; # uWSGI&apos;s socket = 192.168.x.x:8001</span><br><span class="line">&#125;#uwsgi 服务器的ip和port </span><br><span class="line">server &#123;</span><br><span class="line">	listen 80;</span><br><span class="line">	server_name  192.168.180.131;#nginx服务器的ip和端口号</span><br><span class="line">	charset utf-8;</span><br><span class="line">	location / &#123;</span><br><span class="line">		uwsgi_pass  django99;</span><br><span class="line">		include  /usr/local/uwsgi_params; # the uwsgi_params file you installed</span><br><span class="line">	&#125;	</span><br><span class="line">	location /static &#123;</span><br><span class="line">		alias /usr/local/static; # your Django project&apos;s static files - namend as required</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>配置好后，重启nginx即可</p>
<h5 id="克隆虚拟环境"><a href="#克隆虚拟环境" class="headerlink" title="克隆虚拟环境"></a>克隆虚拟环境</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt; 1.vi /etc/sysconfig/network-scripts/ifcfg-eth0</span><br><span class="line">&gt; 2.删除HWADDR所在行，和UUID所在行</span><br><span class="line">&gt; 3.删除 /etc/udev/rules.d/70-persistent-net.rules</span><br><span class="line">&gt; 4.reboot 重启虚拟机</span><br><span class="line">&gt;</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
</blockquote>
<p>##负载均衡策略</p>
<blockquote>
<p>搭建uWSGI集群，只需要多做积分uWSGI的配置文件，文件中设置不同的ip:port，指向不同的project，然后启动多个uWSGI即可</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">*默认:轮询 rr</span><br><span class="line">		upstream django &#123;</span><br><span class="line">			server <span class="number">192.168</span><span class="number">.0</span><span class="number">.103</span>:<span class="number">8989</span>;</span><br><span class="line">			server <span class="number">192.168</span><span class="number">.0</span><span class="number">.103</span>:<span class="number">8990</span>;</span><br><span class="line">		&#125;</span><br><span class="line">*iphash:基于ip的负载均衡.</span><br><span class="line">		upstream django &#123;</span><br><span class="line">			ip_hash;</span><br><span class="line">			server <span class="number">192.168</span><span class="number">.0</span><span class="number">.103</span>:<span class="number">8989</span>;</span><br><span class="line">			server <span class="number">192.168</span><span class="number">.0</span><span class="number">.103</span>:<span class="number">8990</span>;</span><br><span class="line">		&#125;</span><br><span class="line">*权重轮询:</span><br><span class="line">        upstream django &#123;</span><br><span class="line">			server <span class="number">192.168</span><span class="number">.0</span><span class="number">.103</span>:<span class="number">8989</span> weight=<span class="number">1</span>;</span><br><span class="line">			server <span class="number">192.168</span><span class="number">.0</span><span class="number">.103</span>:<span class="number">8990</span> weight=<span class="number">2</span>;</span><br><span class="line">		&#125;</span><br><span class="line">*最小连接数：</span><br><span class="line">		upstream django &#123;</span><br><span class="line">			least_conn;</span><br><span class="line">			server <span class="number">192.168</span><span class="number">.0</span><span class="number">.103</span>:<span class="number">8989</span>;</span><br><span class="line">			server <span class="number">192.168</span><span class="number">.0</span><span class="number">.103</span>:<span class="number">8990</span>;</span><br><span class="line">		&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>至此，一个uWSGI集群搭建完成，nginx作为反向代理服务器和web服务器接收请求，然后处理静态的部分，动态部分按照负载均衡策略转发给某一个uWSGI服务器。</p>
<p>至此python-web-project成功运行于 一个对高并发有更好支持，具有高可用性的系统中</p>
</blockquote>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/生产环境搭建.md/" data-id="cjur52whi0003okv9btqemgap" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/linux下生产环境搭建.md/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          linux下生产环境搭建
        
      </div>
    </a>
  
  
    <a href="/hello-world.md/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Hello World</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/">April 2019</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/linux下生产环境搭建.md/">linux下生产环境搭建</a>
          </li>
        
          <li>
            <a href="/生产环境搭建.md/">(no title)</a>
          </li>
        
          <li>
            <a href="/hello-world.md/">Hello World</a>
          </li>
        
          <li>
            <a href="/supervisor的安装与使用.md/">supervisor安装与使用</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2019 John Doe<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>



  </div>
</body>
</html>